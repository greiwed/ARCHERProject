/*
 * Location_Algorithm.c
 *
 *  Created on: Nov 15, 2019
 *      Author: Daniel
 */

#include "main.h"
#include "Location_Algorithm.h"
#include "arm_math.h"

#define EXEMPLAR_LENGTH 5000
#define X_LIM 240
#define Y_LIM 150
#define SPEED_SOUND 13500

static int16_t tempTimeData[SMALL_BUFF_SIZE / 4];
//volatile static float32_t sqrtCorrect = 181.019;
volatile static float32_t sqrtCorrect = 46340.95;


void location_Algorithm(int16_t* clapLoc){

	// Variables
	int16_t* readBuffAddr;
	uint32_t i;
	uint32_t j;
	int16_t maxMic1;
	uint32_t mic1Idx;
	int16_t maxMic2;
	uint32_t mic2Idx;
	int16_t maxMic3;
	uint32_t mic3Idx;
	int16_t maxMic4;
	uint32_t mic4Idx;
	volatile float32_t delay1;
	volatile float32_t delay2;
	volatile float32_t delay3;
	volatile float32_t delay4;
	volatile float32_t delay12;
	volatile float32_t delay13;
	volatile float32_t delay14;
	volatile float32_t delay23;
	volatile float32_t delay24;
	volatile float32_t delay34;
	volatile float32_t aveDelayDiff;
	volatile float32_t delayArr[4];
	volatile float32_t minDelay;
	volatile uint32_t minDelayIdx;
	volatile uint32_t randomNum;
	volatile uint32_t select;
	volatile int32_t mic1Loc[] = {0,0};
	volatile int32_t mic2Loc[] = {0,Y_LIM};
	volatile int32_t mic3Loc[] = {X_LIM,Y_LIM};
	volatile int32_t mic4Loc[] = {X_LIM,0};
	volatile int32_t sign;


	if(LL_DMA_CURRENTTARGETMEM0 == LL_DMA_GetCurrentTargetMem(DMA2,LL_DMA_STREAM_0)){
		readBuffAddr = (int16_t*) LL_DMA_GetMemory1Address(DMA2,LL_DMA_STREAM_0);
		sign = 1;
	}else if (LL_DMA_CURRENTTARGETMEM1 == LL_DMA_GetCurrentTargetMem(DMA2,LL_DMA_STREAM_0)){
		readBuffAddr = (int16_t*) LL_DMA_GetMemoryAddress(DMA2,LL_DMA_STREAM_0);
		sign = -1;
	}else{
		clapLoc[0] = X_LIM / 2;
		clapLoc[1] = Y_LIM / 2;
		return;
	}

	// Mic 1 Characteristics
	j = 0;
	for(i = 0; i < SMALL_BUFF_SIZE;i+=4){
		tempTimeData[j] = readBuffAddr[i];
		j++;
	}

	arm_abs_q15(tempTimeData, tempTimeData, (SMALL_BUFF_SIZE / 4));
	arm_max_q15(tempTimeData, (SMALL_BUFF_SIZE / 4), &maxMic1, &mic1Idx);
	delay1 = mic1Idx / (float32_t) SAMP_FREQ;

	// Mic 2 Characteristics
	j = 0;
	for(i = 0; i < SMALL_BUFF_SIZE;i+=4){
		tempTimeData[j] = readBuffAddr[i+1];
		j++;
	}

	arm_abs_q15(tempTimeData, tempTimeData, (SMALL_BUFF_SIZE / 4));
	arm_max_q15(tempTimeData, (SMALL_BUFF_SIZE / 4), &maxMic2, &mic2Idx);
	delay2 = mic2Idx / (float32_t) SAMP_FREQ;

	// Mic 3 Characteristics
	j = 0;
	for(i = 0; i < SMALL_BUFF_SIZE;i+=4){
		tempTimeData[j] = readBuffAddr[i+2];
		j++;
	}

	arm_abs_q15(tempTimeData, tempTimeData, (SMALL_BUFF_SIZE / 4));
	arm_max_q15(tempTimeData, (SMALL_BUFF_SIZE / 4), &maxMic3, &mic3Idx);
	delay3 = mic3Idx / (float32_t) SAMP_FREQ;

	// Mic 4 Characteristics
	j = 0;
	for(i = 0; i < SMALL_BUFF_SIZE;i+=4){
		tempTimeData[j] = readBuffAddr[i+3];
		j++;
	}

	arm_abs_q15(tempTimeData, tempTimeData, (SMALL_BUFF_SIZE / 4));
	arm_max_q15(tempTimeData, (SMALL_BUFF_SIZE / 4), &maxMic4, &mic4Idx);
	delay4 = mic4Idx / (float32_t) SAMP_FREQ;

	// Delay differences
	delay12 = delay2 - delay1;
	delay13 = delay3 - delay1;
	delay14 = delay4 - delay1;
	delay23 = delay3 - delay2;
	delay24 = delay4 - delay2;
	delay34 = delay4 - delay3;

	// Absolute value of delays
	arm_abs_f32(&delay12,&delay12,1);
	arm_abs_f32(&delay13,&delay13,1);
	arm_abs_f32(&delay14,&delay14,1);
	arm_abs_f32(&delay23,&delay23,1);
	arm_abs_f32(&delay24,&delay24,1);
	arm_abs_f32(&delay34,&delay34,1);

	delayArr[0] = delay1 + 0.00001;
	delayArr[1] = delay2 + 0.00002;
	delayArr[2] = delay3 + 0.00003;
	delayArr[3] = delay4 + 0.00004;

	arm_min_f32(delayArr,4,&minDelay,&minDelayIdx);

	aveDelayDiff = (delay12 + delay13 + delay14 + delay23 + delay24 + delay34) / 6;

	randomNum = LL_TIM_GetCounter(TIM2);
	if(randomNum <= 58){
		select = 1;
	}else if(randomNum <= 116){
		select = 2;
		randomNum = randomNum / 2;
	}else if(randomNum <= 174){
		select = 3;
		randomNum = randomNum / 3;
	}else if(randomNum <= 232){
		select = 4;
		randomNum = randomNum / 4;
	}else if(randomNum <= 290){
		select = 5;
		randomNum = randomNum / 5;
	}else{
		select = 1;
	}
	int stepSize = 6;
	int32_t stepRand = (int) ((((float32_t) randomNum / (float32_t) 58)) * 10);

	if(sign == 1){
		stepRand = stepRand;
	}else if (sign == -1){
		stepRand = -stepRand;
	}
	if(aveDelayDiff < 0.01){
		if(select == 1){
			clapLoc[0] = (X_LIM / 2) + stepRand;
			clapLoc[1] = (Y_LIM / 2) + stepRand;
		}else if(select == 2){
			clapLoc[0] = (X_LIM / 2) - stepSize + stepRand;
			clapLoc[1] = (Y_LIM / 2) + stepSize + stepRand;
		}else if(select == 3){
			clapLoc[0] = (X_LIM / 2) + stepSize + stepRand;
			clapLoc[1] = (Y_LIM / 2) + stepSize + stepRand;
		}else if(select == 4){
			clapLoc[0] = (X_LIM / 2) + stepSize + stepRand;
			clapLoc[1] = (Y_LIM / 2) - stepSize + stepRand;
		}else if(select == 5){
			clapLoc[0] = (X_LIM / 2) - stepSize + stepRand;
			clapLoc[1] = (Y_LIM / 2) - stepSize + stepRand;
		}
	}else if(minDelayIdx == 0){
		if(select == 1){
			clapLoc[0] = mic1Loc[0] + (X_LIM / 4) + stepRand;
			clapLoc[1] = mic1Loc[1] + (Y_LIM / 4) + stepRand;
		}else if(select == 2){
			clapLoc[0] = mic1Loc[0] + (X_LIM / 4) - stepSize + stepRand;
			clapLoc[1] = mic1Loc[1] + (Y_LIM / 4) + stepSize + stepRand;
		}else if(select == 3){
			clapLoc[0] = mic1Loc[0] + (X_LIM / 4) + stepSize + stepRand;
			clapLoc[1] = mic1Loc[1] + (Y_LIM / 4) + stepSize + stepRand;
		}else if(select == 4){
			clapLoc[0] = mic1Loc[0] + (X_LIM / 4) + stepSize + stepRand;
			clapLoc[1] = mic1Loc[1] + (Y_LIM / 4) - stepSize + stepRand;
		}else if(select == 5){
			clapLoc[0] = mic1Loc[0] + (X_LIM / 4) - stepSize + stepRand;
			clapLoc[1] = mic1Loc[1] + (Y_LIM / 4) - stepSize + stepRand;
		}
	}else if(minDelayIdx == 1){
		if(select == 1){
			clapLoc[0] = mic2Loc[0] + (X_LIM / 4) + stepRand;
			clapLoc[1] = mic2Loc[1] - (Y_LIM / 4) + stepRand;
		}else if(select == 2){
			clapLoc[0] = mic2Loc[0] + (X_LIM / 4) - stepSize + stepRand;
			clapLoc[1] = mic2Loc[1] - (Y_LIM / 4) + stepSize + stepRand;
		}else if(select == 3){
			clapLoc[0] = mic2Loc[0] + (X_LIM / 4) + stepSize + stepRand;
			clapLoc[1] = mic2Loc[1] - (Y_LIM / 4) + stepSize + stepRand;
		}else if(select == 4){
			clapLoc[0] = mic2Loc[0] + (X_LIM / 4) + stepSize + stepRand;
			clapLoc[1] = mic2Loc[1] - (Y_LIM / 4) - stepSize + stepRand;
		}else if(select == 5){
			clapLoc[0] = mic2Loc[0] + (X_LIM / 4) - stepSize + stepRand;
			clapLoc[1] = mic2Loc[1] - (Y_LIM / 4) - stepSize + stepRand;
		}
	}else if(minDelayIdx == 2){
		if(select == 1){
			clapLoc[0] = mic3Loc[0] - (X_LIM / 4) + stepRand;
			clapLoc[1] = mic3Loc[1] - (Y_LIM / 4) + stepRand;
		}else if(select == 2){
			clapLoc[0] = mic3Loc[0] - (X_LIM / 4) - stepSize + stepRand;
			clapLoc[1] = mic3Loc[1] - (Y_LIM / 4) + stepSize + stepRand;
		}else if(select == 3){
			clapLoc[0] = mic3Loc[0] - (X_LIM / 4) + stepSize + stepRand;
			clapLoc[1] = mic3Loc[1] - (Y_LIM / 4) + stepSize + stepRand;
		}else if(select == 4){
			clapLoc[0] = mic3Loc[0] - (X_LIM / 4) + stepSize + stepRand;
			clapLoc[1] = mic3Loc[1] - (Y_LIM / 4) - stepSize + stepRand;
		}else if(select == 5){
			clapLoc[0] = mic3Loc[0] - (X_LIM / 4) - stepSize + stepRand;
			clapLoc[1] = mic3Loc[1] - (Y_LIM / 4) - stepSize + stepRand;
		}
	}else if(minDelayIdx == 3){
		if(select == 1){
			clapLoc[0] = mic4Loc[0] - (X_LIM / 4) + stepRand;
			clapLoc[1] = mic4Loc[1] + (Y_LIM / 4) + stepRand;
		}else if(select == 2){
			clapLoc[0] = mic4Loc[0] - (X_LIM / 4) - stepSize + stepRand;
			clapLoc[1] = mic4Loc[1] + (Y_LIM / 4) + stepSize + stepRand;
		}else if(select == 34){
			clapLoc[0] = mic4Loc[0] - (X_LIM / 4) + stepSize + stepRand;
			clapLoc[1] = mic4Loc[1] + (Y_LIM / 4) + stepSize + stepRand;
		}else if(select == 4){
			clapLoc[0] = mic4Loc[0] - (X_LIM / 4) + stepSize + stepRand;
			clapLoc[1] = mic4Loc[1] + (Y_LIM / 4) - stepSize + stepRand;
		}else if(select == 5){
			clapLoc[0] = mic4Loc[0] - (X_LIM / 4) - stepSize + stepRand;
			clapLoc[1] = mic4Loc[1] + (Y_LIM / 4) - stepSize + stepRand;
		}
	}else{
		clapLoc[0] = (X_LIM / 2) + stepRand;
		clapLoc[1] = (Y_LIM / 2) + stepRand;
	}



/*
	int16_t* readBuffAddr;
	uint32_t i;
	uint32_t j;
	int16_t maxMic1;
	uint32_t mic1Idx;
	int16_t maxMic2;
	uint32_t mic2Idx;
	int16_t maxMic3;
	uint32_t mic3Idx;
	int16_t maxMic4;
	uint32_t mic4Idx;
	volatile float32_t delay1;
	volatile float32_t delay2;
	volatile float32_t delay3;
	volatile float32_t delay4;
	volatile float32_t delay12;
	volatile float32_t delay13;
	volatile float32_t delay14;
	volatile float32_t delay23;
	volatile float32_t delay24;
	volatile float32_t delay34;
	volatile float32_t maxDelay12;
	volatile float32_t maxDelay13;
	volatile float32_t maxDelay14;
	volatile float32_t maxDelay23;
	volatile float32_t maxDelay24;
	volatile float32_t maxDelay34;
	int32_t mic12TempDist;
	int32_t mic13TempDist;
	int32_t mic14TempDist;
	int32_t mic23TempDist;
	int32_t mic24TempDist;
	int32_t mic34TempDist;
	float32_t mic12Dist;
	float32_t mic13Dist;
	float32_t mic14Dist;
	float32_t mic23Dist;
	float32_t mic24Dist;
	float32_t mic34Dist;
	volatile int32_t mic1Loc[] = {0,0};
	volatile int32_t mic2Loc[] = {0,Y_LIM};
	volatile int32_t mic3Loc[] = {X_LIM,Y_LIM};
	volatile int32_t mic4Loc[] = {X_LIM,0};

	if(LL_DMA_CURRENTTARGETMEM0 == LL_DMA_GetCurrentTargetMem(DMA2,LL_DMA_STREAM_0)){
		readBuffAddr = (int16_t*) LL_DMA_GetMemory1Address(DMA2,LL_DMA_STREAM_0);
	}else if (LL_DMA_CURRENTTARGETMEM1 == LL_DMA_GetCurrentTargetMem(DMA2,LL_DMA_STREAM_0)){
		readBuffAddr = (int16_t*) LL_DMA_GetMemoryAddress(DMA2,LL_DMA_STREAM_0);
	}else{
		clapLoc[0] = X_LIM / 2;
		clapLoc[1] = Y_LIM / 2;
		return;
	}

	// Mic 1 Characteristics
	j = 0;
	for(i = 0; i < SMALL_BUFF_SIZE;i+=4){
		tempTimeData[j] = readBuffAddr[i];
		j++;
	}

	arm_abs_q15(tempTimeData, tempTimeData, (SMALL_BUFF_SIZE / 4));
	arm_max_q15(tempTimeData, (SMALL_BUFF_SIZE / 4), &maxMic1, &mic1Idx);
	delay1 = mic1Idx / (float32_t) SAMP_FREQ;

	// Mic 2 Characteristics
	j = 0;
	for(i = 0; i < SMALL_BUFF_SIZE;i+=4){
		tempTimeData[j] = readBuffAddr[i+1];
		j++;
	}

	arm_abs_q15(tempTimeData, tempTimeData, (SMALL_BUFF_SIZE / 4));
	arm_max_q15(tempTimeData, (SMALL_BUFF_SIZE / 4), &maxMic2, &mic2Idx);
	delay2 = mic2Idx / (float32_t) SAMP_FREQ;

	// Mic 3 Characteristics
	j = 0;
	for(i = 0; i < SMALL_BUFF_SIZE;i+=4){
		tempTimeData[j] = readBuffAddr[i+2];
		j++;
	}

	arm_abs_q15(tempTimeData, tempTimeData, (SMALL_BUFF_SIZE / 4));
	arm_max_q15(tempTimeData, (SMALL_BUFF_SIZE / 4), &maxMic3, &mic3Idx);
	delay3 = mic3Idx / (float32_t) SAMP_FREQ;

	// Mic 4 Characteristics
	j = 0;
	for(i = 0; i < SMALL_BUFF_SIZE;i+=4){
		tempTimeData[j] = readBuffAddr[i+3];
		j++;
	}

	arm_abs_q15(tempTimeData, tempTimeData, (SMALL_BUFF_SIZE / 4));
	arm_max_q15(tempTimeData, (SMALL_BUFF_SIZE / 4), &maxMic4, &mic4Idx);
	delay4 = mic4Idx / (float32_t) SAMP_FREQ;

	// Find initial Delays
	delay12 = delay2 - delay1;
	delay13 = delay3 - delay1;
	delay14 = delay4 - delay1;
	delay23 = delay3 - delay2;
	delay24 = delay4 - delay2;
	delay34 = delay4 - delay3;

	// Shift Delays into Bounds by Mic Location

	arm_sqrt_q31((mic1Loc[0] - mic2Loc[0])*(mic1Loc[0] - mic2Loc[0]) + (mic1Loc[1] - mic2Loc[1])*(mic1Loc[1] - mic2Loc[1]),&mic12TempDist);
	arm_sqrt_q31((mic1Loc[0] - mic3Loc[0])*(mic1Loc[0] - mic3Loc[0]) + (mic1Loc[1] - mic3Loc[1])*(mic1Loc[1] - mic3Loc[1]),&mic13TempDist);
	arm_sqrt_q31((mic1Loc[0] - mic4Loc[0])*(mic1Loc[0] - mic4Loc[0]) + (mic1Loc[1] - mic4Loc[1])*(mic1Loc[1] - mic4Loc[1]),&mic14TempDist);
	arm_sqrt_q31((mic2Loc[0] - mic3Loc[0])*(mic2Loc[0] - mic3Loc[0]) + (mic2Loc[1] - mic3Loc[1])*(mic2Loc[1] - mic3Loc[1]),&mic23TempDist);
	arm_sqrt_q31((mic2Loc[0] - mic4Loc[0])*(mic2Loc[0] - mic4Loc[0]) + (mic2Loc[1] - mic4Loc[1])*(mic2Loc[1] - mic4Loc[1]),&mic24TempDist);
	arm_sqrt_q31((mic4Loc[0] - mic3Loc[0])*(mic4Loc[0] - mic3Loc[0]) + (mic4Loc[1] - mic3Loc[1])*(mic4Loc[1] - mic3Loc[1]),&mic34TempDist);
	mic12Dist = (float32_t) mic12TempDist / sqrtCorrect;
	mic13Dist = (float32_t) mic13TempDist / sqrtCorrect;
	mic14Dist = (float32_t) mic14TempDist / sqrtCorrect;
	mic23Dist = (float32_t) mic23TempDist / sqrtCorrect;
	mic24Dist = (float32_t) mic24TempDist / sqrtCorrect;
	mic34Dist = (float32_t) mic34TempDist / sqrtCorrect;
	maxDelay12 = (float32_t) mic12Dist / (float32_t)SPEED_SOUND;
	maxDelay13 = (float32_t) mic13Dist / (float32_t)SPEED_SOUND;
	maxDelay14 = (float32_t) mic14Dist / (float32_t)SPEED_SOUND;
	maxDelay23 = (float32_t) mic23Dist/ (float32_t)SPEED_SOUND;
	maxDelay24 = (float32_t) mic24Dist / (float32_t)SPEED_SOUND;
	maxDelay34 = (float32_t) mic34Dist / (float32_t)SPEED_SOUND;

	// Correct Delay12
	if(delay12 > maxDelay12){
		delay12 = 0.75 * maxDelay12;
	}else if(delay12 < -maxDelay12){
		delay12 = 0.75 * -maxDelay12;
	}

	// Correct Delay13
	if(delay13 > maxDelay13){
		delay13 = 0.75 * maxDelay13;
	}else if(delay13 < -maxDelay13){
		delay13 = 0.75 * -maxDelay13;
	}

	// Correct Delay14
	if(delay14 > maxDelay14){
		delay14 = 0.75 * maxDelay14;
	}else if(delay14 < -maxDelay14){
		delay14 = 0.75 * -maxDelay14;
	}

	// Correct Delay23
	if(delay23 > maxDelay23){
		delay23 = 0.75 * maxDelay23;
	}else if(delay23 < -maxDelay23){
		delay23 = 0.75 * -maxDelay23;
	}

	// Correct Delay24
	if(delay24 > maxDelay24){
		delay24 = 0.75 * maxDelay24;
	}else if(delay24 < -maxDelay24){
		delay24 = 0.75 * -maxDelay24;
	}

	// Correct Delay34
	if(delay34 > maxDelay34){
		delay34 = 0.75 * maxDelay34;
	}else if(delay34 < -maxDelay34){
		delay34 = 0.75 * -maxDelay34;
	}

	// Calculate Location of Clap
	int16_t tempX;
	int16_t tempY;
	int16_t tempDist1;
	int16_t tempDist2;
	int16_t tempDist3;
	int16_t tempDist4;
	float32_t tempDelay1;
	float32_t tempDelay2;
	float32_t tempDelay3;
	float32_t tempDelay4;
	float32_t tempDelay12;
	float32_t tempDelay13;
	float32_t tempDelay14;
	float32_t tempDelay23;
	float32_t tempDelay24;
	float32_t tempDelay34;
	float32_t tempErr;
	float32_t bestErr = 1000000;
	int16_t bestX = X_LIM / 2;
	int16_t bestY = Y_LIM / 2;

	for(tempX = 0;tempX <= X_LIM;tempX++){
		for(tempY = 0;tempY <= Y_LIM;tempY++){

			// Calculate Estimate Distances
			arm_sqrt_q15((mic1Loc[0] - tempX)*(mic1Loc[0] - tempX) + (mic1Loc[1] - tempY)*(mic1Loc[1] - tempY),&tempDist1);
			arm_sqrt_q15((mic2Loc[0] - tempX)*(mic2Loc[0] - tempX) + (mic2Loc[1] - tempY)*(mic2Loc[1] - tempY),&tempDist2);
			arm_sqrt_q15((mic3Loc[0] - tempX)*(mic3Loc[0] - tempX) + (mic3Loc[1] - tempY)*(mic3Loc[1] - tempY),&tempDist3);
			arm_sqrt_q15((mic4Loc[0] - tempX)*(mic4Loc[0] - tempX) + (mic4Loc[1] - tempY)*(mic4Loc[1] - tempY),&tempDist4);

			// Calculate Estimate Delays
			tempDelay1 = (float32_t)tempDist1 / (float32_t) SPEED_SOUND;
			tempDelay2 = (float32_t)tempDist2 / (float32_t) SPEED_SOUND;
			tempDelay3 = (float32_t)tempDist3 / (float32_t) SPEED_SOUND;
			tempDelay4 = (float32_t)tempDist4 / (float32_t) SPEED_SOUND;

			// Calculate Estimate Relative Delays
			tempDelay12 = tempDelay2 - tempDelay1;
			tempDelay13 = tempDelay3 - tempDelay1;
			tempDelay14 = tempDelay4 - tempDelay1;
			tempDelay23 = tempDelay3 - tempDelay2;
			tempDelay24 = tempDelay4 - tempDelay2;
			tempDelay34 = tempDelay4 - tempDelay3;

			// Calculate Error
			tempErr = (tempDelay12 - delay12)*(tempDelay12 - delay12) + (tempDelay13 - delay13)*(tempDelay13 - delay13) + (tempDelay14 - delay14)*(tempDelay14 - delay14) + (tempDelay23 - delay23)*(tempDelay23 - delay23) + (tempDelay24 - delay24)*(tempDelay24 - delay24) + (tempDelay34 - delay34)*(tempDelay34 - delay34);

			// Compare to Previous Best Error
			if(tempErr < bestErr){
				bestErr = tempErr;
				bestX = tempX;
				bestY = tempY;
			}
		}
	}

	clapLoc[0] = bestX;
	clapLoc[1] = bestY;
	*/

}




/*
static int16_t tempCorrData[2 * EXEMPLAR_LENGTH - 1]
							   __attribute__ ((aligned ));
//static int16_t tempScratchBuff[EXEMPLAR_LENGTH + (SMALL_BUFF_SIZE / 2)-2]
//							   __attribute__ ((aligned )) ;
int16_t clapLoc[2];

static int16_t exemplar[] __attribute__ ((aligned)) =
{
	-180,-241,265,320,107,14,-113,74,141,-206,-53,162,110,234,-174,-134,115,70,67,-148,136,
	-8,-41,-178,6,199,339,-67,191,14,180,98,-13,80,-79,198,-76,74,120,194,23,-104,182,74,5,
	-263,173,-30,148,-46,-80,205,10,-5,108,175,294,-70,-27,-13,230,196,423,-76,145,56,236,
	60,-182,-1,87,115,101,-161,388,382,221,-167,-14,109,106,143,-177,124,184,196,313,-54,
	105,-228,206,-71,305,-38,191,284,260,18,41,-42,248,192,-30,479,116,-3,256,194,-152,285,
	0,-16,233,218,-204,271,19,149,-19,325,270,8,250,14,249,20,-217,175,210,-149,183,163,-4,
	141,100,124,12,-101,-63,-37,271,20,102,-67,-112,129,240,-349,100,189,-52,189,121,-140,7,
	285,132,4,-137,-23,313,89,138,361,235,277,6,-34,231,56,148,6,67,97,283,-110,195,121,-69,
	43,31,91,268,255,136,301,11,-162,26,0,309,69,98,-277,-247,-251,128,289,-30,-86,-28,82,12,
	287,-55,-171,34,187,-212,-134,-129,46,106,154,-149,139,-171,-285,-47,-177,342,249,-12,201,
	178,-17,-177,272,85,128,134,300,-42,1,290,-157,-80,-54,-10,180,325,84,-330,-12,172,6,73,
	-26,30,-281,-30,17,-7,-219,-124,207,-49,-138,154,-72,-106,-61,186,21,104,-12,-149,-171,
	-18,75,-63,-134,-102,124,-82,93,-308,-128,62,-17,-104,13,-507,-220,-85,-71,-79,240,321,72,
	-123,91,46,180,245,232,-16,41,44,-106,-80,291,29,95,-156,310,122,185,-29,271,-305,117,17,79,
	-56,37,30,-66,133,-6,-87,2,221,192,23,174,-22,116,277,-113,261,-46,-5,106,243,31,320,236,
	-108,-83,-201,-56,29,-245,35,277,-123,-9,187,-129,-102,38,55,-84,-156,305,-53,-12,9,-115,
	-130,117,125,-136,195,147,59,101,-129,137,-13,21,-103,39,-176,175,76,-144,-56,-30,104,-28,
	201,127,-60,27,227,143,206,100,37,84,-112,72,385,43,38,494,75,-97,27,284,19,-137,-32,254,
	90,-171,79,-33,-90,95,339,205,43,-157,357,-10,0,-26,-110,55,44,-4,143,-8,206,-154,-52,73,
	-22,182,-137,16,116,-13,-120,-90,-130,-114,53,80,201,242,-87,-140,-46,-246,-130,-16,-263,
	-48,147,-181,-170,-2,803,714,905,286,559,-13,138,634,352,36,-389,-672,-1289,-1443,-437,1095,
	2167,1916,-321,-604,-909,-1179,917,1450,1016,1025,505,744,695,365,-273,-1772,-3066,-4062,
	-4355,-3039,-1799,-1620,-1748,-631,2612,11396,7953,4221,5882,695,-5078,-1014,4413,876,-9134,
	-10888,-11105,-8688,-4408,2053,5813,531,850,1828,8362,7377,7867,5656,10732,8262,5823,1179,
	-5721,-7363,-6148,-2731,-2674,-6895,-6496,-3241,-4627,-2212,4204,992,-582,1080,1245,3649,
	3440,3605,4854,4032,2878,568,-2337,-3517,-780,-690,-388,1097,3503,3745,3757,-482,-4927,
	-8509,-4779,2725,4938,3810,-1133,-3980,-4273,-2707,-153,3170,1137,-1791,-1613,33,3778,
	6754,5982,4283,2771,-400,-2954,-9055,-7708,-4494,-3140,-8,5093,3364,-2532,40,-827,509,2882,
	-226,-241,-1648,835,6205,2528,-1903,-1824,2297,6486,6447,2153,-836,-3727,-3366,-2175,-1999,
	341,1553,-1412,-4894,-3966,-3518,-1263,2299,4889,5415,4774,4609,4126,3896,274,-3160,-2810,
	-4205,-2654,159,-130,-2107,254,3578,-1690,-6363,-5779,-3347,-5820,-4215,2317,4647,3446,2418,
	3097,1259,-1867,2202,2670,-608,-1136,-1171,-1218,657,2887,4114,2236,128,-745,619,421,430,
	899,1152,1726,1579,-1452,-2297,-2070,-2932,-3106,-2696,-1436,-246,484,443,1690,2881,2408,
	737,-193,3136,1560,-339,1741,1201,-597,365,267,-956,-1943,-923,-1203,-1954,-1144,-413,-1072,
	-923,-1068,-288,1617,2906,3406,2916,1624,1267,197,-669,-786,-1734,-2645,-2307,-2358,-2353,
	-811,721,714,1366,2431,1361,299,-463,-1278,-2393,-1591,1172,1827,1979,1677,1952,1169,-995,
	-385,-556,-1462,397,2043,-132,-309,-351,-77,-2164,-2393,-809,-169,43,1224,2059,-119,-1271,
	-1088,-2174,-1807,649,3434,2619,1445,1569,317,-376,1300,2266,725,-687,-667,-510,1065,3303,
	-482,-1894,-2211,-1012,-128,-1381,-1988,-1373,-1237,-412,1261,1412,1552,2717,-3618,-1305,
	4683,5225,3238,1005,-2603,-2189,-405,-294,1480,1138,-197,423,515,-1194,-1974,-853,-1113,
	-2795,-3430,-3173,-2914,-2923,-62,2442,-161,670,3160,2717,4238,4524,3360,1573,517,-747,
	-1474,-2031,-1163,-693,-1946,-955,-821,-1475,-1043,-1972,-909,919,2133,3503,3472,2503,3151,
	529,1851,1881,-658,1929,1863,-2032,-1419,-521,-2558,-2015,-1796,-2388,-1616,1031,2487,2766,
	2342,967,1859,809,-1534,-2029,-803,-969,-1252,-1367,-2174,-3867,-3465,-461,-1408,-543,2247,
	2544,3197,2834,1067,819,590,910,1955,2151,885,991,-186,-846,931,1857,139,-1135,-2230,-3624,
	-2162,-1612,-1070,1447,2484,2386,2101,443,-108,-582,-378,-692,-8,429,-711,-184,70,-25,-153,
	-460,845,638,-78,1092,1023,212,-784,68,-758,-615,-303,-489,-1853,-2719,-1326,-1740,1461,
	2517,720,636,764,-117,2,-14,663,-2068,-191,1196,53,720,1638,1159,-442,-375,2087,1950,956,
	1737,120,-695,884,1151,437,990,29,1000,1887,590,188,126,-1350,-1155,-1156,-2415,-2942,-1393,
	-1541,-2396,-523,-707,-307,996,711,1299,243,709,1555,1063,292,1737,1512,-102,243,-142,-617,
	-657,-667,-1462,-929,779,508,2037,2152,583,974,-113,-1407,-694,-72,617,-244,-628,566,618,
	425,1916,1262,-661,-605,-1437,-619,-970,-970,-893,-1536,-1155,1347,1388,517,-180,-614,
	-873,-1574,362,728,561,832,307,-616,-597,-679,-98,151,414,786,-78,-1364,485,445,1375,2828,
	1180,-1070,-707,-1257,-2395,-2047,-1762,-2267,-1496,-1045,900,582,1247,2723,-152,266,1498,
	863,1112,1430,1276,756,304,46,-362,-857,-126,1193,318,-1077,-758,-287,-7,-644,901,329,-1055,
	-912,-817,-1053,-745,418,158,482,534,534,-265,-730,294,793,-359,-792,661,1202,986,1222,
	1578,889,190,30,-201,59,242,-379,677,587,-269,-213,-439,-2001,-1155,-207,18,783,-493,-412,
	673,-813,92,1677,118,-1139,-1155,111,-845,-600,329,480,-81,-522,222,775,906,1071,798,-851,
	-663,-1363,-1108,504,583,-656,-394,-742,-1622,37,-30,-151,684,923,1380,1801,1402,2165,2036,
	1142,627,630,76,-677,-468,575,709,112,-317,327,-528,-1358,-545,280,443,-207,627,-443,-155,
	-203,-993,-874,-520,-297,-557,-326,-86,629,2002,1937,1002,825,973,326,361,377,852,63,-10,
	-121,-967,-970,-957,-923,-722,-703,-304,-4,-291,701,1573,-145,-367,1140,435,-47,509,-257,
	-945,-1137,321,1308,474,-126,-300,-743,-1251,-1327,-478,55,-8,-74,188,-36,-159,-318,444,
	170,256,568,884,1669,-560,-1402,381,-18,-496,1230,922,215,1346,790,89,-853,-1204,-245,
	-269,-168,468,51,-499,-159,381,628,190,623,396,-666,-122,602,-373,300,976,165,402,172,575,
	964,-661,-246,358,-501,-265,421,264,-156,369,-159,-634,-553,198,1072,925,772,563,446,119,
	-1017,-365,408,-678,-284,782,634,-735,186,575,-399,-170,-256,-1319,-1204,-143,-752,-472,
	502,189,497,395,176,315,772,562,923,515,-47,539,959,736,498,324,387,-223,-660,-853,-319,
	-835,-623,-330,-701,577,924,795,2014,2521,1326,664,126,-710,-1292,-1165,-1344,-610,157,
	465,-141,30,256,-115,251,-1,154,501,574,477,-75,-291,-330,-584,-182,-237,-15,-782,-563,
	-551,-730,-429,1,-283,257,552,155,1053,2132,1004,732,829,37,-387,107,-52,32,-186,-745,
	-228,167,-567,83,1191,919,1007,527,884,397,-218,-243,300,-351,-494,-279,-378,-775,-618,
	-279,181,362,781,200,-171,-407,-288,144,-136,86,-110,-796,-112,-123,397,-623,-450,-111,
	-303,-1034,187,1053,58,656,806,-319,-346,-99,295,287,439,917,414,179,89,-24,10,-176,23,
	703,338,-612,-88,-149,-52,55,17,403,195,-31,670,683,292,140,472,636,248,-44,463,220,-484,
	-209,-506,-224,429,686,34,-199,95,-371,-457,232,326,-459,-59,161,-354,-958,-475,216,145,
	165,576,-59,-67,36,191,-144,-508,-21,-329,-638,-29,419,-286,-245,155,288,66,1012,625,58,
	484,236,-747,172,530,726,1015,277,-472,-15,-163,-453,-290,227,-386,-601,-891,-721,-151,
	484,358,420,553,-197,170,892,260,-91,426,-836,-1052,-452,-459,-124,-260,-216,-814,-251,
	579,488,1062,813,723,277,392,177,258,193,10,-388,-471,390,400,404,430,-492,222,-205,-203,
	-508,56,-346,-1484,-168,-59,-705,550,771,116,166,670,-4,-1027,-91,683,149,435,1037,609,
	-365,-328,654,181,-112,845,-297,-527,-131,-39,-72,461,310,367,-223,-164,214,-461,-459,
	-254,-201,-115,395,1004,855,533,292,148,-305,-563,14,437,-407,-896,-209,461,231,18,-189,
	-439,85,308,-200,-224,-150,-360,-859,-571,-103,-382,-476,558,732,486,472,257,243,-63,286,
	-535,-1064,67,-8,130,406,665,507,685,-214,300,375,203,99,-102,73,654,780,582,730,131,-284,
	-261,-564,-95,238,142,-385,-639,-274,-994,-1277,-638,-75,-474,377,1685,1442,820,710,-127,
	-674,-227,-255,-285,-107,250,428,320,100,-131,-192,-5,-142,94,563,-292,-835,-152,380,433,
	685,387,-202,83,87,-682,-116,130,396,540,523,538,370,-378,-425,-409,-261,-49,586,321,195,
	201,-39,-88,-451,102,-309,-754,-163,-53,-728,-396,86,51,-49,-312,47,-129,-95,266,201,93,
	238,190,312,555,183,40,287,78,21,191,-100,-39,391,803,391,206,-110,-585,-738,-480,577,2,
	316,833,142,-29,622,20,-165,-235,193,-299,-133,-333,-432,-2,-197,108,717,333,-163,80,122,
	-211,-261,148,34,-308,-394,-169,168,-62,508,297,-130,284,2,277,642,87,313,38,-584,-756,
	-364,-276,-115,367,716,220,103,470,634,390,687,397,-236,-394,-383,-301,38,15,-554,-860,
	-594,-350,171,-154,-176,198,572,-130,696,912,93,95,434,21,117,444,49,43,73,-187,-456,
	-201,-671,-512,-44,-21,-576,-291,-178,-159,287,814,849,93,253,-235,-247,-193,343,257,
	-193,-571,-447,-613,-540,92,266,324,1115,583,611,792,81,229,956,129,-202,-5,145,-278,-66,
	-107,-59,-49,-144,-349,-281,314,248,237,288,406,276,822,388,-95,-295,-632,-65,-438,-412,
	167,-223,-271,177,-177,170,315,-339,-286,365,456,570,1333,743,307,-59,-497,-88,-174,346,
	557,355,-366,-260,-401,-330,83,90,346,-9,207,558,395,-38,-86,-171,36,2,466,17,582,205,367,
	286,338,-5,-167,-308,-768,37,-268,-345,-141,796,565,755,755,698,185,-43,-374,-108,310,548,
	332,-177,-441,-461,172,450,569,156,-42,99,23,-238,-135,-297,72,603,683,467,586,206,30,-321,
	54,109,-77,350,-52,-279,53,337,728,406,635,98,-59,619,324,47,-406,-291,81,57,212,329,190,
	84,139,418,519,783,975,-43,-43,-199,-372,-202,352,914,382,-384,2,33,-660,-205,143,493,193,
	284,531,-25,-80,348,480,63,-77,226,23,-793,-84,442,-113,387,486,71,338,-28,-314,249,-82,
	-530,-36,105,-80,456,498,317,211,361,95,314,50,55,-92,-8,120,155,-400,236,-189,-178,-239,
	-143,-378,142,42,403,437,429,202,-394,-473,75,-115,-68,292,133,345,357,121,386,-201,-164,
	-74,-421,511,525,266,469,633,607,335,404,774,279,180,23,-302,86,112,-123,35,195,-247,-437,
	268,450,-45,249,546,240,300,-159,-442,-943,-796,-389,-593,-108,231,139,499,339,-11,328,
	-319,-465,320,192,291,-150,259,375,252,533,354,680,801,31,-39,43,-150,-47,-198,-489,-275,
	-598,-85,342,445,583,227,80,746,185,-166,-183,-179,113,577,393,331,-309,-832,-1160,-756,
	-371,-493,-763,-718,-339,-460,-237,209,716,708,728,671,450,306,291,284,742,118,215,69,
	-184,325,381,-304,182,-18,148,75,58,-364,-250,-197,268,779,434,254,395,-214,-70,-38,140,
	432,445,456,530,387,-202,-193,-565,-691,-664,-393,-446,-290,219,112,-425,104,329,-101,
	-119,-202,-464,-129,140,409,-176,-148,-99,-96,201,54,447,277,-39,147,-9,-159,-161,-30,-49,
	478,324,270,63,347,836,729,418,252,-265,-698,-40,45,378,649,327,547,-230,-115,281,-195,82,
	-266,-51,-297,-671,-133,139,174,293,284,-165,179,500,498,876,296,325,51,-58,-401,-259,151,
	-250,-119,-419,-580,-306,-174,59,245,-27,4,126,23,128,146,64,314,203,-513,-165,-517,-94,
	-239,122,-183,21,285,204,42,118,-266,14,-17,76,73,182,224,572,235,182,499,336,227,172,300,
	250,113,208,312,398,361,129,309,162,463,161,145,158,-389,-252,29,-58,220,160,389,342,-86,
	234,-87,6,195,23,255,-40,-74,-44,-38,213,17,10,13,-14,98,157,-160,-114,-171,-470,-311,-1,
	112,94,280,147,134,538,-171,-157,-85,108,226,163,621,369,182,507,477,127,141,641,250,321,
	474,315,84,158,154,103,231,452,227,270,329,448,278,359,-139,-233,-19,-16,-302,-302,-94,432,
	557,498,363,-42,-178,71,-286,185,30,171,-56,232,-205,-13,101,-378,-235,-252,77,-163,171,
	-284,-66,240,-31,-309,-298,-199,174,322,252,762,556,382,286,421,462,271,256,334,-65,327,
	183,482,95,165,-90,-153,125,181,236,260,209,631,-157,-288,485,174,44,584,84,-110,-102,133,
	-132,-16,57,-37,203,394,13,-339,-16,-118,113,40,368,401,429,324,-74,148,122,65,427,481,279,
	112,0,-101,40,104,143,3,319,67,-267,749,1051,323,214,6,-147,-256,-98,494,145,94,584,173,
	-26,-83,9,-459,-296,-203,-220,-498,-215,-48,194,39,57,33,-50,-49,-288,-82,-380,-427,83,197,
	-84,-66,-49,-338,120,274,-184,69,139,258,181,523,785,229,-86,227,-115,-214,326,362,216,
	-179,189,86,79,236,151,-168,-29,356,80,536,270,492,118,385,112,111,21,-159,-369,-408,-400,
	62,-199,-36,86,-137,-82,189,-90,-90,82,-283,330,485,202,-19,207,24,312,-118,179,597,268,
	-78,448,-243,-17,160,86,-60,366,173,-255,-164,-121,141,9,91,-52,-107,-184,529,-32,-408,
	-163,7,14,392,113,437,-243,77,183,64,171,12,99,37,149,-78,308,93,-35,540,395,-160,148,203,
	-17,-323,311,242,233,191,-69,108,-231,-140,-19,163,28,-85,54,-198,146,-116,5,255,323,-184,
	172,34,-99,90,208,209,481,510,536,604,163,-106,-132,-196,-152,256,189,7,-275,-286,-308,48,
	133,-120,-326,36,-214,217,444,-49,379,322,-0,-522,258,-61,147,-161,313,186,292,345,-60,340,
	112,185,464,354,233,376,418,-105,85,167,-148,-58,-196,-130,-4,249,628,375,100,320,13,-255,
	296,262,-100,-3,60,-188,-49,-233,-192,63,284,742,425,545,372,245,-13,244,-65,33,243,-227,
	-92,-403,-116,200,80,-9,45,-162,43,342,178,330,404,4,-78,759,860,374,355,130,-583,-212,
	-271,-400,-100,-400,-261,-161,-158,300,-6,236,140,167,29,-73,-192,-309,17,-308,-18,47,209,
	453,69,-216,171,71,-17,239,-108,-154,524,374,134,60,34,287,-208,44,151,2,109,-148,86,166,
	-35,-15,17,12,185,166,170,301,552,-111,-83,198,-75,292,11,100,-332,3,192,-318,-145,-75,-56,
	-310,-64,-277,-140,195,249,264,173,-95,81,5,197,-102,232,186,65,265,-85,32,139,423,547,451,
	113,55,-430,-364,-300,-139,-63,569,-190,-288,-385,-117,-307,-109,285,291,-53,-83,-96,32,
	239,4,51,82,-0,-59,-20,-6,242,541,200,258,60,-257,-142,-125,-318,-290,-383,85,-320,-331,
	111,120,471,102,-65,19,-313,15,99,-72,-45,120,120,57,200,17,14,-56,94,-68,116,305,-247,
	-261,-307,113,-124,-111,61,-313,-198,-222,-221,159,134,131,273,714,389,-10,166,118,-437,
	-339,-156,-84,66,291,-72,99,60,2,-125,79,61,-182,408,159,-15,366,308,-232,503,234,178,444,
	221,-181,-489,-119,-295,132,305,-53,10,131,-307,-243,126,-13,-81,65,224,-172,-435,-202,
	-53,-211,-161,-19,-343,108,265,-106,336,470,565,500,452,70,154,34,-301,-209,-87,-241,135,
	472,579,315,-111,-89,-92,237,327,16,-88,-51,145,161,239,450,259,86,281,74,129,-15,-174,
	-104,-387,130,398,30,256,418,1,-181,38,-227,-485,354,257,195,-182,-52,69,-337,-247,243,
	-426,-90,112,184,184,342,82,-57,-14,-105,-35,-173,205,104,421,221,293,-195,-226,326,47,
	-210,-163,-324,78,78,-433,-154,-115,-479,208,-39,-285,-88,34,-130,159,80,138,383,58,315,
	147,530,631,395,120,-208,5,307,258,369,108,211,80,-44,95,-84,-56,405,54,30,101,-195,-186,
	-269,354,-32,-26,85,-153,275,121,397,324,-47,177,-211,-306,-138,221,288,269,286,344,438,
	340,20,368,-100,-258,-68,-20,-59,28,-289,-26,-7,235,251,158,-137,-67,112,1,511,-40,352,363,
	-245,93,-241,213,-69,-146,138,94,52,-31,-181,-179,345,63,-174,-21,107,89,106,239,472,15,2,
	-125,-371,-193,42,101,-178,17,45,-34,-272,97,136,-200,-199,-150,151,156,271,130,386,90,296,
	-25,119,128,208,165,21,229,13,-7,-472,253,-297,34,-214,-187,-334,169,-267,-346,-2,18,-162,
	-191,348,40,14,41,350,109,-124,-119,-44,312,125,229,68,147,-35,375,301,426,326,304,170,267,
	308,8,217,402,260,149,83,272,545,129,122,77,5,-68,15,-15,-274,-87,9,-143,363,269,195,-2,
	-118,-73,299,212,-179,134,130,-45,-181,-304,-37,-197,154,-93,-148,-52,66,288,77,179,374,
	139,126,223,38,287,83,192,6,-33,170,-200,-392,-74,-124,103,-167,39,224,258,-171,277,72,122,
	235,146,305,452,456,463,149,-58,152,189,2,603,149,-38,-16,-153,-95,47,132,-293,-131,-315,
	261,-182,-126,282,150,-129,78,298,-414,241,-111,94,324,73,-177,70,327,181,-58,92,-64,-6,
	133,-99,-246,-327,168,161,78,465,117,-315,1,179,282,582,364,421,458,203,89,54,89,537,207,
	3,-463,-85,156,-152,232,184,175,191,-356,177,15,-95,264,-322,46,-60,213,-113,136,44,-259,
	67,-29,-360,-288,-86,-63,-38,150,123,214,156,-4,75,159,108,211,116,270,161,101,21,316,141,
	124,61,9,129,-56,-117,332,295,-1,53,18,-181,-1,124,100,217,15,-18,-232,-20,-389,-340,-304,
	187,12,405,119,-162,60,266,253,118,-300,38,-286,98,-29,-282,444,113,17,348,175,227,57,-110,
	-68,-93,-34,38,44,175,-203,91,143,-123,-183,-65,-90,90,167,-273,-149,289,221,-54,368,129,
	52,51,71,141,-87,-117,255,173,-44,243,-215,104,-26,-69,-126,-127,191,364,42,-47,169,117,
	252,140,105,-8,-39,58,283,-63,314,6,226,94,113,-7,-31,292,-107,-52,154,247,209,457,274,269,
	115,282,247,-78,-9,247,69,-125,129,320,-59,-62,180,355,72,7,26,-66,93,-115,151,-161,116,
	52,444,-220,-159,133,150,2,230,309,208,46,643,61,-159,68,98,5,78,187,-262,184,-117,338,347,
	-80,181,-349,229,-40,125,-139,-364,258,371,470,825,99,215,-227,-148,-330,91,73,-11,66,-41,
	355,224,527,-2,384,-151,-81,18,90,178,401,227,236,128,247,79,255,-22,312,-106,45,-60,168,4,
	533,-116,116,-49,65,117,126,274,157,375,407,95,450,281,-118,52,71,-292,240,193,182,68,192,
	-4,186,-147,242,-161,1,155,220,219,82,342,376,532,478,102,622,308,-31,-21,-57,-59,-115,319,
	499,269,217,121,82,-373,-315,-123,33,123,-385,-20,-32,132,195,307,-226,-18,126,120,-75,
	183,62,55,51,-59,-13,-18,154,-100,-295,-32,-15,-33,114,-13,-106,538,350,-23,145,126,295,
	126,546,282,221,175,326,66,206,147,107,166,37,233,85,-241,167,-575,-171,3,65,-28,-87,210,
	115,439,19,74,295,260,138,217,237,-208,-74,306,-106,-146,-77,123,116,254,246,-46,-155,373,
	110,49,252,209,238,-183,-151,106,-296,-89,298,177,289,423,363,242,-80,18,87,71,349,45,230,
	80,-174,170,7,68,-175,311,59,-15,478,111,135,314,506,-34,-174,78,-229,131,138,52,-130,-48,
	-536,-212,-1,338,335,-178,-145,-347,15,118,-30,138,267,406,561,233,-36,105,-99,80,113,520,
	224,40,155,-19,91,87,179,120,-125,92,-119,107,212,81,255,80,114,-123,-15,-240,117,248,275,
	-26,-111,-28,-141,-17,46,119,123,278,-159,26,-143,29,336,-181,65,-106,442,-49,-37,160,-32,
	143,31,123,264,294,302,137,336,341,227,109,123,-343,-227,-92,37,199,5,150,-168,-41,303,-13,
	26,-92,4,-88,-16,275,228,276,268,257,-2,81,-99,36,188,172,-73,8,198,102,-17,173,354,132,215,
	-62,59,89,316,33,167,406,10,-105,-126,61,136,82,-379,-143,56,38,216,224,-205,-95,6,103,-111,
	-19,36,40,-61,250,234,163,331,31,245,157,242,260,223,197,309,357,-320,253,69,-34,-83,279,
	-63,174,121,-94,142,39,-133,301,91,-4,-76,-97,171,-22,306,343,256,412,278,134,-47,-29,53,
	-45,287,453,195,-107,-90,188,-261,65,-218,75,138,-32,-29,265,381,-13,214,225,40,366,81,177,
	496,-155,-32,188,-2,52,-167,328,45,-362,35,-133,-23,-258,36,13,326,-87,311,118,-31,-79,310,
	601,225,253,-58,-179,127,-234,86,-144,208,24,-15,117,-299,51,-190,56,201,94,-110,242,-125,
	62,233,140,103,126,-198,-120,3,270,53,171,332,74,-85,-59,209,146,-38,-162,161,40,193,62,
	-238,56,61,-76,206,-72,41,195,199,152,416,277,256,250,46,84,189,47,37,424,72,210,-109,-202,
	-131,-167,294,42,-174,67,27,-129,-96,25,-387,-16,-45,22,35,-38,-81,331,195,-109,-123,-161,
	-84,-31,-190,192,334,67,128,-98,-87,121,-37,314,76,60,284,-77,87,-8,582,225,135,210,225,
	182,118,-113,229,467,268,107,251,140,40,-7,-141,-225,-188,133,210,49,184,21,246,385,300,235,
	67,147,125,-197,-128,-10,-52,-28,52,127,61,139,-154,135,404,47,5,10,47,-78,-5,263,110,181,
	154,-2,-47,-0,-407,231,-47,152,198,188,-38,348,-52,203,28,-84,-260,241,-37,129,-92,-19,
	-118,-221,103,-154,-82,-14,-18,-150,153,188,117,-33,174,-16,143,-5,-32,156,21,279,-121,220,
	56,-119,273,-5,363,-105,116,-21,-82,85,163,293,2,119,-14,-20,-214,227,106,101,154,208,194,
	434,182,253,152,-262,313,78,-62,46,425,35,29,124,-165,93,-95,-140,-94,86,-86,-44,-168,-63,
	170,1,33,-58,-201,-103,-100,143,-173,-159,-282,-165,316,-9,70,-135,-113,-187,36,-134,95,23,
	309,7,154,100,100,58,224,-230,144,-24,193,-134,15,-36,57,-2,18,-19,-28,-28,146,73,420,81,9,
	148,-95,261,70,236,329,377,248,97,199,229,294,77,200,179,36,-129,-19,192,-122,138,-158,
	-143,-17,-165,-101,-6,151,122,366,31,119,-61,257,259,-34,222,222,65,-159,48,92,137,-81,9,
	112,-278,10,158,78,359,133,-111,59,189,341,92,187,-110,-99,9,149,-14,96,130,175,58,-150,19,
	37,69,81,174,274,-40,332,28,47,219,-166,258,165,-164,139,-123,229,-48,172,234,-282,-172,77,
	-230,-36,-88,-76,-159,245,-11,56,260,23,-163,76,241,150,179,-22,-7,43,-152,-7,-22,-253,49,
	-30,-107,-181,-147,-61,31,278,-83,470,-60,-29,48,286,203,395,-70,-115,82,36,-17,-117,-7,19,
	303,5,-91,54,139,205,-196,-126,-51,-174,-207,207,-18,59,-137,-115,-166,-98,3,45,170,-208,
	-196,73,-35,-38,-5,203,217,19,-124,77,338,44,47,27,-97,11,-61,-418,60,-88,102,-114,-143,-73,
	-136,-89,13,-138,-118,55,0,265,-109,-104,-192,143,101,-81,247,36,-59,364,-2,-123,105,-266,
	-60,121,237,-127,144,392,-89,-75,250,157,160,202,-41,-123,401,-56,35,-7,19,-115,-177,-114,
	-324,149,306,-212,265,62,133,-71,46,-5,223,85,-186,-214,151,116,21,336,16,78,-103,-126,120,
	-107,-119,33,92,-271,-179,98,-152,-76,-65,-208,220,13,3,312,50,448,-52,-47,379,-165,-148,
	483,63,-78,-69,152,120,29,-57,56,-134,32,39,4,298,5,-308,20,-135,-120,219,-141,237,46,307,
	-270,325,202,-24,362,-22,-116,187,112,60,-27,51,306,-19,-30,262,-318,-346,321,-171,-116,-6,
	-158,-199,-195,-310,-176,-110,69,539,59,289,123,246,-66,64,76,159,166,329,236,-6,313,172,
	250,-212,247,123,24,-156,-12,77,-100,-46,54,-143,-44,-178,-3,-319,-109,-347,-148,-110,-345,
	87,-28,53,47,-176,80,204,-110,-100,-52,-23,78,-57,93,254,-63,-310,215,101,85,-159,-11,-56,
	106,-240,-135,-9,196,-129,198,85,-93,-48,59,156,-88,58,-214,-104,73,-144,117,152,-89,-75,
	61,-75,-94,-116,-67,216,-19,-162,1,-13,108,11,3,-191,-185,32,-3,-175,17,99,-167,-169,-16,
	-29,0,7,3,-167,-187,-141,29,145,2,8,-160,165,0,80,-144,100,-1,-185,-81,42,-49,-149,-171,-9,
	72,-82,-165,0,83,85,1,21,19,-1,-1,-1,1,0,5,-201,-77,26,-0,-120,-162,7,34,42,11,-164,5,3,-41,
	-201,80,82,-1,-5,-165,-5,-5,10,5,22,4,85,94,0,89,0,-201,0,0,1,5,0,6,-23,-3,-10,1,0,41,41,0,
	41,41,0,0,4,-1,0,3,0,12,1,42,39,-5,-159,6,-185,-247,-259,-108,0,-247,1,41,-19,-5,-165,-8,0,
	0,46,87,26,5,82,1,82,41,15,80,82,-21,-51,-165,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

int16_t* location_Algorithm(void){

	int16_t* readBuffAddr;
	uint32_t i;
	uint32_t j;
	int16_t xCorrMax1;
	uint32_t xCorrIdx1;
	int16_t xCorrMax2;
	uint32_t xCorrIdx2;
	int16_t xCorrMax3;
	uint32_t xCorrIdx3;
	int16_t xCorrMax4;
	uint32_t xCorrIdx4;
	float32_t delay1;
	float32_t delay2;
	float32_t delay3;
	float32_t delay4;
	float32_t delay12;
	float32_t maxDelay12;
	float32_t delay13;
	float32_t maxDelay13;
	float32_t delay14;
	float32_t maxDelay14;
	float32_t delay23;
	float32_t maxDelay23;
	float32_t delay24;
	float32_t maxDelay24;
	float32_t delay34;
	float32_t maxDelay34;
	int16_t mic14Dist;
	int16_t mic23Dist;
	int16_t mic1Loc[] = {X_LIM,Y_LIM};
	int16_t mic2Loc[] = {X_LIM,0};
	int16_t mic3Loc[] = {0,Y_LIM};
	int16_t mic4Loc[] = {0,0};


	if(LL_DMA_CURRENTTARGETMEM0 == LL_DMA_GetCurrentTargetMem(DMA2,LL_DMA_STREAM_0)){
		readBuffAddr = (int16_t*) LL_DMA_GetMemory1Address(DMA2,LL_DMA_STREAM_0);
	}else if (LL_DMA_CURRENTTARGETMEM1 == LL_DMA_GetCurrentTargetMem(DMA2,LL_DMA_STREAM_0)){
		readBuffAddr = (int16_t*) LL_DMA_GetMemoryAddress(DMA2,LL_DMA_STREAM_0);
	}

	// Mic 1 Characteristics
	j = 0;
	for(i = 0; i < SMALL_BUFF_SIZE;i+=4){
		tempTimeData[j] = readBuffAddr[i];
		j++;
	}

	//arm_correlate_fast_opt_q15(exemplar, EXEMPLAR_LENGTH, tempTimeData, (SMALL_BUFF_SIZE/4), tempCorrData,tempScratchBuff);
	arm_correlate_fast_q15(exemplar, EXEMPLAR_LENGTH, tempTimeData, (SMALL_BUFF_SIZE/4), tempCorrData);
	arm_abs_q15(tempCorrData, tempCorrData, (2 * EXEMPLAR_LENGTH - 1));
	arm_max_q15(tempCorrData, (2 * EXEMPLAR_LENGTH - 1), &xCorrMax1, &xCorrIdx1);
	delay1 = (float32_t)xCorrIdx1 / (float32_t)SAMP_FREQ;

	/*
	// Mic 2 Characteristics
	j = 0;
	for(i = 0; i < SMALL_BUFF_SIZE;i+=4){
		tempTimeData[j] = readBuffAddr[i+1];
		j++;
	}

	arm_correlate_fast_opt_q15(exemplar, EXEMPLAR_LENGTH, tempTimeData, (SMALL_BUFF_SIZE/4), tempCorrData,tempScratchBuff);
	arm_abs_q15(tempCorrData, tempCorrData, (2 * EXEMPLAR_LENGTH - 1));
	arm_max_q15(tempCorrData, (2 * EXEMPLAR_LENGTH - 1), &xCorrMax2, &xCorrIdx2);
	delay2 = (float32_t)xCorrIdx2 / (float32_t)SAMP_FREQ;

	// Mic 3 Characteristics
	j = 0;
	for(i = 0; i < SMALL_BUFF_SIZE;i+=4){
		tempTimeData[j] = readBuffAddr[i+2];
		j++;
	}

	arm_correlate_fast_opt_q15(exemplar, EXEMPLAR_LENGTH, tempTimeData, (SMALL_BUFF_SIZE/4), tempCorrData,tempScratchBuff);
	arm_abs_q15(tempCorrData, tempCorrData, (2 * EXEMPLAR_LENGTH - 1));
	arm_max_q15(tempCorrData, (2 * EXEMPLAR_LENGTH - 1), &xCorrMax3, &xCorrIdx3);
	delay3 = (float32_t)xCorrIdx3 / (float32_t)SAMP_FREQ;

	// Mic 4 Characteristics
	j = 0;
	for(i = 0; i < SMALL_BUFF_SIZE;i+=4){
		tempTimeData[j] = readBuffAddr[i+3];
		j++;
	}

	arm_correlate_fast_opt_q15(exemplar, EXEMPLAR_LENGTH, tempTimeData, (SMALL_BUFF_SIZE/4), tempCorrData,tempScratchBuff);
	arm_abs_q15(tempCorrData, tempCorrData, (2 * EXEMPLAR_LENGTH - 1));
	arm_max_q15(tempCorrData, (2 * EXEMPLAR_LENGTH - 1), &xCorrMax4, &xCorrIdx4);
	delay4 = (float32_t)xCorrIdx4 / (float32_t)SAMP_FREQ;

	// Find initial Delays
	delay12 = delay2 - delay1;
	delay13 = delay3 - delay1;
	delay14 = delay4 - delay1;
	delay23 = delay3 - delay2;
	delay24 = delay4 - delay2;
	delay34 = delay4 - delay3;

	// Shift Delays into Bounds by Mic Location
	maxDelay12 = (float32_t)(mic1Loc[1] - mic2Loc[1]) / (float32_t)SPEED_SOUND;
	maxDelay13 = (float32_t)(mic1Loc[0] - mic3Loc[0]) / (float32_t)SPEED_SOUND;
	arm_sqrt_q15((mic1Loc[0] - mic4Loc[0])*(mic1Loc[0] - mic4Loc[0]) + (mic1Loc[1] - mic4Loc[1])*(mic1Loc[1] - mic4Loc[1]),&mic14Dist);
	maxDelay14 = (float32_t) mic14Dist / (float32_t)SPEED_SOUND;
	arm_sqrt_q15((mic2Loc[0] - mic3Loc[0])*(mic2Loc[0] - mic3Loc[0]) + (mic2Loc[1] - mic3Loc[1])*(mic2Loc[1] - mic3Loc[1]),&mic23Dist);
	maxDelay23 = (float32_t) mic23Dist/ (float32_t)SPEED_SOUND;
	maxDelay24 = (float32_t)(mic2Loc[0] - mic4Loc[0]) / (float32_t)SPEED_SOUND;
	maxDelay34 = (float32_t)(mic3Loc[1] - mic4Loc[1]) / (float32_t)SPEED_SOUND;

	// Correct Delay12
	if(delay12 > maxDelay12){
		delay12 = 0.75 * maxDelay12;
	}else if(delay12 < -maxDelay12){
		delay12 = 0.75 * -maxDelay12;
	}

	// Correct Delay13
	if(delay13 > maxDelay13){
		delay13 = 0.75 * maxDelay13;
	}else if(delay13 < -maxDelay13){
		delay13 = 0.75 * -maxDelay13;
	}

	// Correct Delay14
	if(delay14 > maxDelay14){
		delay14 = 0.75 * maxDelay14;
	}else if(delay14 < -maxDelay14){
		delay14 = 0.75 * -maxDelay14;
	}

	// Correct Delay23
	if(delay23 > maxDelay23){
		delay23 = 0.75 * maxDelay23;
	}else if(delay23 < -maxDelay23){
		delay23 = 0.75 * -maxDelay23;
	}

	// Correct Delay24
	if(delay24 > maxDelay24){
		delay24 = 0.75 * maxDelay24;
	}else if(delay24 < -maxDelay24){
		delay24 = 0.75 * -maxDelay24;
	}

	// Correct Delay34
	if(delay34 > maxDelay34){
		delay34 = 0.75 * maxDelay34;
	}else if(delay34 < -maxDelay34){
		delay34 = 0.75 * -maxDelay34;
	}

	// Determine First Microphone Detection

	// Calculate Location of Clap
	int16_t tempX;
	int16_t tempY;
	int16_t tempDist1;
	int16_t tempDist2;
	int16_t tempDist3;
	int16_t tempDist4;
	float32_t tempDelay1;
	float32_t tempDelay2;
	float32_t tempDelay3;
	float32_t tempDelay4;
	float32_t tempDelay12;
	float32_t tempDelay13;
	float32_t tempDelay14;
	float32_t tempDelay23;
	float32_t tempDelay24;
	float32_t tempDelay34;
	float32_t tempErr;
	float32_t bestErr = 1000000;
	int16_t bestX = X_LIM / 2;
	int16_t bestY = Y_LIM / 2;

	for(tempX = 0;tempX <= X_LIM;tempX++){
		for(tempY = 0;tempY <= Y_LIM;tempY++){

			// Calculate Estimate Distances
			arm_sqrt_q15((mic1Loc[0] - tempX)*(mic1Loc[0] - tempX) + (mic1Loc[1] - tempY)*(mic1Loc[1] - tempY),&tempDist1);
			arm_sqrt_q15((mic2Loc[0] - tempX)*(mic2Loc[0] - tempX) + (mic2Loc[1] - tempY)*(mic2Loc[1] - tempY),&tempDist2);
			arm_sqrt_q15((mic3Loc[0] - tempX)*(mic3Loc[0] - tempX) + (mic3Loc[1] - tempY)*(mic3Loc[1] - tempY),&tempDist3);
			arm_sqrt_q15((mic4Loc[0] - tempX)*(mic4Loc[0] - tempX) + (mic4Loc[1] - tempY)*(mic4Loc[1] - tempY),&tempDist4);

			// Calculate Estimate Delays
			tempDelay1 = (float32_t)tempDist1 / (float32_t) SPEED_SOUND;
			tempDelay2 = (float32_t)tempDist2 / (float32_t) SPEED_SOUND;
			tempDelay3 = (float32_t)tempDist3 / (float32_t) SPEED_SOUND;
			tempDelay4 = (float32_t)tempDist4 / (float32_t) SPEED_SOUND;

			// Calculate Estimate Relative Delays
			tempDelay12 = tempDelay2 - tempDelay1;
			tempDelay13 = tempDelay3 - tempDelay1;
			tempDelay14 = tempDelay4 - tempDelay1;
			tempDelay23 = tempDelay3 - tempDelay2;
			tempDelay24 = tempDelay4 - tempDelay2;
			tempDelay34 = tempDelay4 - tempDelay3;

			// Calculate Error
			tempErr = (tempDelay12 - delay12)*(tempDelay12 - delay12) + (tempDelay13 - delay13)*(tempDelay13 - delay13) + (tempDelay14 - delay14)*(tempDelay14 - delay14) + (tempDelay23 - delay23)*(tempDelay23 - delay23) + (tempDelay24 - delay24)*(tempDelay24 - delay24) + (tempDelay34 - delay34)*(tempDelay34 - delay34);

			// Compare to Previous Best Error
			if(tempErr < bestErr){
				bestErr = tempErr;
				bestX = tempX;
				bestY = tempY;
			}
		}
	}

	clapLoc[0] = bestX;
	clapLoc[1] = bestY;
	return clapLoc;
}
*/
